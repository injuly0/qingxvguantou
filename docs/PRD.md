
# MoodFlow 产品需求文档 (PRD)

## 1. 项目概述
**项目名称**: MoodFlow
**核心理念**: 结合沉浸式视觉体验与积极心理学（VIA 24项性格力量）的情绪记录工具。
**主要功能**: 用户通过沉浸式的场景卡片选择心情，通过引导式流程记录当下，并结合内在力量进行自我赋能。

## 2. 核心模块划分 (Module Breakdown)

为了方便沟通，我们将应用划分为以下四大核心模块：

### 模块 A: 情绪入口 (Landing & Selection)
*   **对应文件**: `App.tsx`, `components/FerrisWheelCard.tsx`, `components/RoadCard.tsx`, `components/DeepSeaCard.tsx`
*   **功能描述**:
    *   全屏垂直滚动（Snap Scroll）。
    *   **场景 1 (Euphoric/狂喜)**: 摩天轮动画，代表“升空”与“俯瞰”。
    *   **场景 2 (Stable/平稳)**: 公路/像素风动画，代表“在路上”与“前行”。
    *   **场景 3 (Depressed/低落)**: 深海气泡动画，代表“下坠”与“容纳”。
*   **交互**: 
    *   上下滑动切换场景。
    *   点击卡片进入 **模块 C (输入)**。
    *   **特殊逻辑**: 若用户选择积极情绪且未设置过力量，先拦截跳转至 **模块 B**。

### 模块 B: 力量核心 (Power Core / Galaxy)
*   **对应文件**: `components/StrengthPicker.tsx`, `data/strengths.ts`
*   **视觉表现**: 
    *   **星系视图**: 24颗力量星围绕核心旋转。
    *   **六大扇区**: 根据 6大美德 (智慧、勇气、仁爱、公正、节制、卓越) 划分扇区。
    *   **颜色编码**: 不同美德拥有独立的色系。
*   **功能流程**:
    1.  **展开**: 点击核心球体，星系展开。
    2.  **选择**: 
        *   模式一：选择“我的力量” (Current Powers)。
        *   模式二：选择“向往特质” (Ideal Traits)。
    3.  **确认**: 保存数据至本地存储。

### 模块 C: 记录与结晶 (Input & Crystallization)
*   **对应文件**: `components/MoodInput.tsx`
*   **流程步骤 (Savoring Flow)**:
    1.  **Step 1 捕捉 (Capture)**: 
        *   记录具体事件 (`eventText`)。
    2.  **Step 2 归因 (Attribution)**:
        *   选择快乐源头 (Internal/External)。
        *   视觉保持浅色风格。
    3.  **Step 3 链接 (Link to Power)**:
        *   **提示语**: “你感受到了什么力量？为什么会感受到这种力量？”
        *   **交互**: 灵感跑马灯。点击模版，**强制刷新**下方输入框内容。
        *   **输入**: `insightText`。
        *   **跳转**: 按钮改为“预览能量”。
    4.  **Step 4 预览整合 (The Formula)**:
        *   **功能**: 展示即将注入的能量“配方”清单。
        *   **布局**: 
            *   上：Step 1 事件卡片。
            *   中：Step 2 源头图标（连接点）。
            *   下：Step 3 力量感悟。
        *   **动作**: 点击“注入水晶球”按钮。
        *   **数据逻辑**: **点击按钮瞬间完成数据保存**。
    5.  **Step 5 结晶仪式 (The Ritual)**:
        *   **视觉风格**: 迪士尼魔法风，深色沉浸背景。
        *   **核心元素**: 屏幕中央的水晶球。
        *   **动画逻辑**: 
            *   Step 1-3 的内容化作三道流光（粒子）汇入水晶球。
            *   水晶球高亮、旋转、充能（Swirling Light）。
        *   **文案**: “这份力量源泉已存储在【信念树】上”。
        *   **导航**: 动画播放完毕（约3-4秒）后，**自动**淡出并返回 APP 首页。

### 模块 D: 数据与配置 (Data & Config)
*   **对应文件**: `types.ts`, `data/strengths.ts`, `metadata.json`
*   **内容**:
    *   **力量库**: 6大分类、24项具体力量的元数据，包含 **templates**。
    *   **枚举定义**: 心情类型、快乐源头枚举。
    *   **用户数据**: `UserTraits` (当前力量/向往力量)。

## 3. 当前开发状态
- [x] 模块 A 视觉效果与动画。
- [x] 模块 B 星系布局。
- [x] 模块 C 流程重构：分离事件与洞察输入。
- [x] 模块 C 视觉优化：Step 2 亮色化。
- [x] 模块 C 交互优化：走马灯点击覆盖逻辑。
- [x] 模块 C 新增 Step 4 预览页。
- [x] 模块 C 新增 Step 5 水晶球动画。

## 4. 沟通术语约定
*   **“星系”**: 指 StrengthPicker 组件。
*   **“力量 (Power)”**: 替代之前的“优势 (Strength)”。
